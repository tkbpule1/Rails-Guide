#**_Ruby On Rails_**

## SET-UP

```javascript
$ rails new mobtown -d postgresql
```

###Edit Gemfile to include the gems needed for the application.

####Gemfile example from Michael Hartl's [*Rails Tutorial*](www.railstutorial.org)

###Gemfile
```ruby
source 'https://rubygems.org'


# Bundle edge Rails instead: gem 'rails', github: 'rails/rails'
gem 'rails', '4.2.6'
gem 'bootstrap-sass', '3.2.0.0'
gem 'faker', '1.4.2'
gem 'carrierwave', '0.10.0'
gem 'mini_magick', '3.8.0'
gem 'fog', '1.36.0'
gem 'will_paginate', '3.0.7'
gem 'bootstrap-will_paginate', '0.0.10'
# Use postgresql as the database for Active Record
gem 'pg', '~> 0.17.1'
# Use SCSS for stylesheets
gem 'sass-rails', '~> 5.0'
# Use Uglifier as compressor for JavaScript assets
gem 'uglifier', '>= 2.5.0'
# Use CoffeeScript for .coffee assets and views
gem 'coffee-rails', '~> 4.1.0'
# See https://github.com/rails/execjs#readme for more supported runtimes
# gem 'therubyracer', platforms: :ruby

# Use jquery as the JavaScript library
gem 'jquery-rails', '4.0.3'
# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks
gem 'turbolinks', '2.3.0'
# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder
gem 'jbuilder', '~> 2.2.3'
# bundle exec rake doc:rails generates the API under doc/api.
gem 'sdoc', '~> 0.4.0', group: :doc

# Use ActiveModel has_secure_password
gem 'bcrypt', '~> 3.1.7'

# Use Unicorn as the app server
# gem 'unicorn'

# Use Capistrano for deployment
# gem 'capistrano-rails', group: :development

# Having issues with the new version so used an earlier version
gem 'listen', '3.1.0'


group :development, :test do
  # Call 'byebug' anywhere in the code to stop execution and get a debugger console
  gem 'byebug', '3.4.0'

  # Access an IRB console on exception pages or by using <%= console %> in views
  gem 'web-console', '2.0.0.beta3'

  # Spring speeds up development by keeping your application running in the background.
  gem 'spring', '1.1.3'
end

group :test do
  gem 'minitest-reporters', '1.0.5'
  gem 'mini_backtrace', '0.1.3'
  gem 'guard-minitest', '2.3.1'
end

group :production do
  gem 'rails_12factor', '0.0.2'
  gem 'puma', '3.1.0'
end
```

###Start the Server
```ruby
$ rails server #Start the server on locahost:3000
```

###Initialize Git
```javascript
$ git init
$ git add -A
$ git commit -am "Initialize Repository"
```

###Create a new Repository at [Github](www.github.com) or [Bitbucket](www.bitbucket.org)

**Github**
```javascript
$ git remote add origin git@github.com:tkbpule1@gmail.com/name_of_repo.git
```

**Bitbucket**
```javascript
$ git remote add origin https://tkbpule1@bitbucket.org/tkbpule1/name_of_repo.git
```
**I usually use github**

```javascript
$ git push
$ git config --global push.default current /*Push branches to repo*/
```

***

###Configure Application

**/config/database.yml**
```yaml
default: &default
  adapter: postgresql
  encoding: unicode
  host: localhost
  username: mobtown_admin
  password: password
  # For details on connection pooling, see rails configuration guide
  # http://guides.rubyonrails.org/configuring.html#database-pooling
  pool: 5

development:
  <<: *default
  database: mobtown_development

test:
  <<: *default
  database: mobtown_test

production:
  <<: *default
  database: mobtown_production
  password: <%= ENV['MOBTOWN_DATABASE_PASSWORD'] %>
  ```


####Create .gitignore file (if it doesn't exist)

**.gitignore**
```yaml
  # See https://help.github.com/articles/ignoring-files for more about ignoring files.
  #
  # If you find yourself ignoring temporary files generated by your text editor
  # or operating system, you probably want to add a global ignore instead:
  #   git config --global core.excludesfile '~/.gitignore_global'

  # Ignore bundler config.
  /.bundle

  # Ignore all logfiles and tempfiles.
  /log/*
  !/log/.keep
  /tmp

  *.rbc
  capybara-*.html
  .rspec
  /db/*.postgresql
  /db/*.postgres
  /public/system
  /coverage/
  /spec/tmp
  **.orig
  rerun.txt
  pickle-email-*.html
  config/database.yml
  config/initializer/secret_token.rb
  config/secrets.yml
  .env
  /vendor/bundle
  .ruby-version
  .ruby-gemset
  .rvmrc
  .byebug_history
  .powenv
```


#####Configure production environment:

**config/environments/production.rb**
```ruby
# Allows heroku to access secret key
config.secret_key_base = ENV["SECRET_KEY_BASE"]
```

```ruby
# Force all access to the app over SSL
config.force_ssl = true
```

***

###Use Heroku to Deploy Application
```javascript
$ heroku create mobtown
$ git push heroku master
$ heroku logs
```

###Production Webserver

**config/puma.rb**

```ruby
workers Integer(ENV['WEB_CONCURRENCY'] || 2)
threads_count = Integer(ENV['RAILS_MAX_THREADS'] || 5)
threads threads_count, threads_count

preload_app!

rackup        DefaultRackup
port          ENV['PORT']     || 3000
environment   ENV['RACK_ENV'] || 'development'

on_worker_boot do
  ActiveRecord::Base.establish_connection
end
```

**./Procfile**
```php
web: bundle exec puma -C config/puma.rb
```

```javascript
$ git push heroku
$ heroku run rake db:migrate
```

***

##STATIC PAGES

```ruby
$ git checkout -b static-pages

$ rails generate controller StaticPages home help
    create app/controllers/static_pages_controller.rb
     route get 'static_pages/help'
     route get 'static_pages/home'
    invoke erb
    create   app/views/static_pages
    create   app/views/static_pages/home.html.erb
    create   app/views/static_pages/help.html.erb
    invoke test_unit
    create   test/controllers/static_pages_controller_test.rb
    invoke helper
    create   app/helpers/static_pages_helper.rb
    invoke   test_unit
    invoke assets
    invoke   coffee
    create     app/assets/javascript/static_pages.coffee
    invoke   scss
    create     app/assets/stylesheets/static_pages.scss
```

#NOTE: Undoing Things:
```ruby
$ rails destroy controller StaticPages home help
$ rails destroy model User
$ bundle exec rake db:rollback
$ bundle exec rake db:status
$ bundle exec rake db:migrate
```

**config/routes.rb**
```ruby
Rails.application.routes.draw do
  root 'static_pages#home'
  get 'static_pages/home'
  get 'static_pages/help'
end
```

**app/controllers/static_pages_controller.rb**
```ruby
class StaticPagesController < ApplicationController
  def home    
  end

  def help    
  end
end
```

###Customize Static Pages

**app/views/static_pages/home.html.erb**

```html
<h1>Mobtown Offroad</h1>
<p>
  Mobtown Offroad is a small company that creates offroad parts for trucks.
</p>
```

**app/views/static_pages/help.html.erb**
```html
<h1>Help</h1>
<p>
  If you need a product we don't sell, we would be <em>excited</em> to
  hear from you.  <a href="mobtownoffroad.com/contact">Contact Us Here!</a>
</p>
```

***

##Test Driven Development

**test/controllers/static_pages_controller_test.rb**
```ruby
require 'test_helper'

class StaticPagesControllerTest < ActionDispatch::IntegrationTest

  test 'should get home' do
    get :home
    assert_response :success
  end

  test 'should get help' do
    get :help
    assert_response :success
  end
end
```

###Run Test
```java
$ bundle exec rake test
  2 tests, 2 assertions, 0 failures, 0 errors, 0 skips
```

###A test for the About Page
```ruby
test 'should get about' do
  get :about
  assert_response :success
end
```

###Run Test
```java
$ bundle exec rake test
  3 tests, 3 assertions, 0 failures, 1 errors, 0 skips
```

####To solve error, we need to add a *route* to the about page:
**config/routes.rb**
```ruby
Rails.application.routes.draw do
  get 'static_pages/home'
  get 'static_pages/help'
  get 'static_pages/about'
end
```
####Next, we need to create an *Action* to the static_pages_controller
**app/controllers/static_pages_controller.rb**
```ruby
class StaticPagesController < ApplicationController
  def home
  end

  def help
  end

  def about
  end
end
```
###Finally, we need to create a file(*view*) in apps/views/static_pages called about.html.erb
**app/views/static_pages/about.html.erb**
```html
<h1>About Mobtown Offroad</h1>
<p>
  Built for a desire to create <em>awesome</em> <b>offroad parts</b> for
  our own trucks, Mobtown designs and manufactures parts for <b>Toyota</b>
   trucks.
   <b>Made in the USA</b>
</p>
```

###Run Test
```java
$ bundle exec rake test
  3 tests, 3 assertions, 0 failures, 0 errors, 0 skips
```

***

##Create Titles

###Start by creating tests
**test/controllers/static_pages_controller_test.rb**
```ruby
require 'test_helper'

class StaticPagesControllerTest < ActionDispatch::IntegrationTest

  test 'should get home' do
    get :home
    assert_response :success
    assert_select 'title' "#{@base_title}"
  end

  test 'should get help' do
    get :help
    assert_response :success
    assert_select 'title', "Help | #{@base_title}"
  end

  test 'should get about' do
    get :about
    assert_response :success
    assert_select 'title', "About | #{@base_title}"
  end
end
```

###Define base_title
**application_helper.rb**
```ruby
module ApplicationHelper
  # Returns the full title on a per-page basis.
  def full_title(page_title = '')
    base_title = 'Mobtown Offroad'
    if page_title.empty?
      base_title
    else
      page_title + ' | ' + base_title
    end
  end
end
```

###Next, add titles to pages help and home
**app/views/static_pages/help.html.erb**
```html
<% provide(:title, "Help") %>
...
...
```

**app/views/static_pages/about.html.erb**
```html
<% provide(:title, "About") %>
...
...
```

###Finally, add titles to layout
**app/views/layouts/application.html.erb**
```html
<!DOCTYPE html>
<!DOCTYPE html>
<html>
  <head>
    <title><%= full_title(yield(:title)) %></title>
    <%= stylesheet_link_tag 'application', media: 'all',
    'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
    <%= csrf_meta_tags %>
  </head>
  <body>
    <%= yield %>
  </body>
</html>
```

### Now, test should pass:
```java
$ bundle exec rake test
  3 tests, 6 assertions, 0 failures, 0 errors, 0 skips
```
