#**_Ruby On Rails_**

## SET-UP

```javascript
$ rails new mobtown -d postgresql
```

###Edit Gemfile to include the gems needed for the application.

####Gemfile example from Michael Hartl's [*Rails Tutorial*](www.railstutorial.org)

###Gemfile
```ruby
source 'https://rubygems.org'


# Bundle edge Rails instead: gem 'rails', github: 'rails/rails'
gem 'rails', '4.2.6'
gem 'bootstrap-sass', '3.2.0.0'
gem 'faker', '1.4.2'
gem 'carrierwave', '0.10.0'
gem 'mini_magick', '3.8.0'
gem 'fog', '1.36.0'
gem 'will_paginate', '3.0.7'
gem 'bootstrap-will_paginate', '0.0.10'
# Use postgresql as the database for Active Record
gem 'pg', '~> 0.17.1'
# Use SCSS for stylesheets
gem 'sass-rails', '~> 5.0'
# Use Uglifier as compressor for JavaScript assets
gem 'uglifier', '>= 2.5.0'
# Use CoffeeScript for .coffee assets and views
gem 'coffee-rails', '~> 4.1.0'
# See https://github.com/rails/execjs#readme for more supported runtimes
# gem 'therubyracer', platforms: :ruby

# Use jquery as the JavaScript library
gem 'jquery-rails', '4.0.3'
# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks
gem 'turbolinks', '2.3.0'
# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder
gem 'jbuilder', '~> 2.2.3'
# bundle exec rake doc:rails generates the API under doc/api.
gem 'sdoc', '~> 0.4.0', group: :doc

# Use ActiveModel has_secure_password
gem 'bcrypt', '~> 3.1.7'

# Use Unicorn as the app server
# gem 'unicorn'

# Use Capistrano for deployment
# gem 'capistrano-rails', group: :development

# Having issues with the new version so used an earlier version
gem 'listen', '3.1.0'


group :development, :test do
  # Call 'byebug' anywhere in the code to stop execution and get a debugger console
  gem 'byebug', '3.4.0'

  # Access an IRB console on exception pages or by using <%= console %> in views
  gem 'web-console', '2.0.0.beta3'

  # Spring speeds up development by keeping your application running in the background.
  gem 'spring', '1.1.3'
end

group :test do
  gem 'minitest-reporters', '1.0.5'
  gem 'mini_backtrace', '0.1.3'
  gem 'guard-minitest', '2.3.1'
end

group :production do
  gem 'rails_12factor', '0.0.2'
  gem 'puma', '3.1.0'
end
```

###Start the Server
```ruby
$ rails server #Start the server on locahost:3000
```

###Initialize Git
```javascript
$ git init
$ git add -A
$ git commit -am "Initialize Repository"
```

###Create a new Repository at [Github](www.github.com) or [Bitbucket](www.bitbucket.org)

**Github**
```javascript
$ git remote add origin git@github.com:tkbpule1@gmail.com/name_of_repo.git
```

**Bitbucket**
```javascript
$ git remote add origin https://tkbpule1@bitbucket.org/tkbpule1/name_of_repo.git
```
**I usually use github**

```javascript
$ git push
$ git config --global push.default current /*Push branches to repo*/
```

***

###Configure Application

**/config/database.yml**
```yaml
default: &default
  adapter: postgresql
  encoding: unicode
  host: localhost
  username: mobtown_admin
  password: password
  # For details on connection pooling, see rails configuration guide
  # http://guides.rubyonrails.org/configuring.html#database-pooling
  pool: 5

development:
  <<: *default
  database: mobtown_development

test:
  <<: *default
  database: mobtown_test

production:
  <<: *default
  database: mobtown_production
  password: <%= ENV['MOBTOWN_DATABASE_PASSWORD'] %>
  ```


####Create .gitignore file (if it doesn't exist)

**.gitignore**
```yaml
  # See https://help.github.com/articles/ignoring-files for more about ignoring files.
  #
  # If you find yourself ignoring temporary files generated by your text editor
  # or operating system, you probably want to add a global ignore instead:
  #   git config --global core.excludesfile '~/.gitignore_global'

  # Ignore bundler config.
  /.bundle

  # Ignore all logfiles and tempfiles.
  /log/*
  !/log/.keep
  /tmp

  *.rbc
  capybara-*.html
  .rspec
  /db/*.postgresql
  /db/*.postgres
  /public/system
  /coverage/
  /spec/tmp
  **.orig
  rerun.txt
  pickle-email-*.html
  config/database.yml
  config/initializer/secret_token.rb
  config/secrets.yml
  .env
  /vendor/bundle
  .ruby-version
  .ruby-gemset
  .rvmrc
  .byebug_history
  .powenv
```


#####Configure production environment:

**config/environments/production.rb**
```ruby
# Allows heroku to access secret key
config.secret_key_base = ENV["SECRET_KEY_BASE"]
```

```ruby
# Force all access to the app over SSL
config.force_ssl = true
```

***

###Use Heroku to Deploy Application
```javascript
$ heroku create mobtown
$ git push heroku master
$ heroku logs
```

###Production Webserver

**config/puma.rb**

```ruby
workers Integer(ENV['WEB_CONCURRENCY'] || 2)
threads_count = Integer(ENV['RAILS_MAX_THREADS'] || 5)
threads threads_count, threads_count

preload_app!

rackup        DefaultRackup
port          ENV['PORT']     || 3000
environment   ENV['RACK_ENV'] || 'development'

on_worker_boot do
  ActiveRecord::Base.establish_connection
end
```

**./Procfile**
```php
web: bundle exec puma -C config/puma.rb
```

```javascript
$ git push heroku
$ heroku run rake db:migrate
```

***

##STATIC PAGES

```ruby
$ git checkout -b static-pages

$ rails generate controller StaticPages home help
    create app/controllers/static_pages_controller.rb
     route get 'static_pages/help'
     route get 'static_pages/home'
    invoke erb
    create   app/views/static_pages
    create   app/views/static_pages/home.html.erb
    create   app/views/static_pages/help.html.erb
    invoke test_unit
    create   test/controllers/static_pages_controller_test.rb
    invoke helper
    create   app/helpers/static_pages_helper.rb
    invoke   test_unit
    invoke assets
    invoke   coffee
    create     app/assets/javascript/static_pages.coffee
    invoke   scss
    create     app/assets/stylesheets/static_pages.scss
```

#NOTE: Undoing Things:
```ruby
$ rails destroy controller StaticPages home help
$ rails destroy model User
$ bundle exec rake db:rollback
$ bundle exec rake db:status
$ bundle exec rake db:migrate
```

**config/routes.rb**
```ruby
Rails.application.routes.draw do
  root 'static_pages#home'
  get 'help' => 'static_pages#help'
end
```

**app/controllers/static_pages_controller.rb**
```ruby
class StaticPagesController < ApplicationController
  def home    
  end

  def help    
  end
end
```

###Customize Static Pages

**app/views/static_pages/home.html.erb**

```html
<% if logged_in? %>
  <div class="row">
    <aside class="col-md-4">
      <section class="user_info">
        <%= render 'shared/user_info' %>
      </section>
      <section class="micropost_form">
        <%= render 'shared/micropost_form'
      </section>      
    </aside>
    <div class="col-md-8">
      <h3>Micropost Feed</h3>
      <%= render 'shared/feed' %>
    </div>
  </div>
  <% else %>
<div class="center jumbotron">
  <h1>Mobtown Offroad</h1>
  <h2>
    Mobtown Offroad is a small company that creates offroad parts for trucks.
  </h2>

  <%= link_to 'Sign up now!', signup_path, class: "btn btn-lg btn-primary" %>
</div>
<% end %>
```

**app/views/static_pages/help.html.erb**
```html

<h1>Help</h1>
<div class="center jumbotron">
  <h2>
    If you need a product we don't sell, we would be <em>excited</em> to
    hear from you.  <a href="mobtownoffroad.com/contact">Contact Us Here!</a>
  </h2>
</div>
```

***

##Test Driven Development

**test/controllers/static_pages_controller_test.rb**
```ruby
require 'test_helper'

class StaticPagesControllerTest < ActionDispatch::IntegrationTest

  test 'should get home' do
    get :home
    assert_response :success
  end

  test 'should get help' do
    get :help
    assert_response :success
  end
end
```

###Run Test
```java
$ bundle exec rake test
  2 tests, 2 assertions, 0 failures, 0 errors, 0 skips
```

###A test for the About Page
```ruby
test 'should get about' do
  get :about
  assert_response :success
end
```

###Run Test
```java
$ bundle exec rake test
  3 tests, 3 assertions, 0 failures, 1 errors, 0 skips
```

####To solve error, we need to add a *route* to the about page:
**config/routes.rb**
```ruby
Rails.application.routes.draw do
  root 'static_pages/home'
  get 'help' => 'static_pages#help'
  get 'about' => 'static_pages#about'
end
```
####Next, we need to create an *Action* to the static_pages_controller
**app/controllers/static_pages_controller.rb**
```ruby
class StaticPagesController < ApplicationController
  def home
  end

  def help
  end

  def about
  end
end
```
###Finally, we need to create a file(*view*) in apps/views/static_pages called about.html.erb
**app/views/static_pages/about.html.erb**
```html
<div class="center jumbotron">
  <h1>About Mobtown Offroad</h1>
  <h2>
    Built for a desire to create <em>awesome</em> <b>offroad parts</b> for
    our own trucks, Mobtown designs and manufactures parts for <b>Toyota</b>
    trucks.
    <b>Made in the USA</b>
  </h2>
</div>
```

###Run Test
```java
$ bundle exec rake test
  3 tests, 3 assertions, 0 failures, 0 errors, 0 skips
```

***

##Create Titles

###Start by creating tests
**test/controllers/static_pages_controller_test.rb**
```ruby
require 'test_helper'

class StaticPagesControllerTest < ActionDispatch::IntegrationTest

  test 'should get home' do
    get :home
    assert_response :success
    assert_select 'title' "#{@base_title}"
  end

  test 'should get help' do
    get :help
    assert_response :success
    assert_select 'title', "Help | #{@base_title}"
  end

  test 'should get about' do
    get :about
    assert_response :success
    assert_select 'title', "About | #{@base_title}"
  end
end
```

###Define base_title
**application_helper.rb**
```ruby
module ApplicationHelper
  # Returns the full title on a per-page basis.
  def full_title(page_title = '')
    base_title = 'Mobtown Offroad'
    if page_title.empty?
      base_title
    else
      page_title + ' | ' + base_title
    end
  end
end
```

###Next, add titles to pages help and home
**app/views/static_pages/help.html.erb**
```html
<% provide(:title, "Help") %>
...
...
```

**app/views/static_pages/about.html.erb**
```html
<% provide(:title, "About") %>
...
...
```

###Finally, add titles to layout
**app/views/layouts/application.html.erb**
```html
<!DOCTYPE html>
<!DOCTYPE html>
<html>
  <head>
    <title><%= full_title(yield(:title)) %></title>
    <%= stylesheet_link_tag 'application', media: 'all',
    'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
    <%= csrf_meta_tags %>
  </head>
  <body>
    <%= yield %>
  </body>
</html>
```

### Now, test should pass:
```java
$ bundle exec rake test
  3 tests, 6 assertions, 0 failures, 0 errors, 0 skips
```
***
##Advanced Testing Setup
**test/test_helper.rb**
```ruby
ENV['RAILS_ENV'] ||= 'test'
require File.expand_path('../../config/environments', __FILE__)
require 'rails/test_help'
require 'minitest/reporters'
Minitest::Reporters.use!

class ActiveSupport::TestCase
  # Setup all fixtures in test/fixtures/.yml for all tests in alphabetical order.
  fixtures :all
  include ApplicationHelper
end
```

###Create a file (application_helper_test.rb)
**test/helpers/application_helper_test.rb**
```ruby
require 'test_helper'

class ApplicationHelperTest < ActionView::TestCase
  test 'full title helper' do
    assert_equal full_title, "#{@base_title}"
    assert_equal full_title('Help'), "Help | #{@base_title}"
    assert_equal full_title('About'), "About | #{@base_title}"
    assert_equal full_title('Contact'), "Contact | #{@base_title}"
    assert_equal full_title('Login'), "Login | #{@base_title}"
    assert_equal full_title('Signup'), "Signup | #{@base_title}"
  end
```

##Filling in the Site Layout


**app/views/layouts/application.html.erb**
```html
<!DOCTYPE html>
<!DOCTYPE html>
<html>
  <head>
    <title><%= full_title(yield(:title)) %></title>
    <%= csrf_meta_tags %>
    <%= stylesheet_link_tag 'application', media: 'all',
                                           'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
    <%= render 'layouts/shim' %>
  </head>
  <body>
    <%= render 'layouts/header' %>
    <div class="container">
      <% flash.each do |msg_type, msg| %>
        <div class="alert alert-<%= msg_type %>">
          <%= msg %>
        </div>
      <% end %>
      <%= yield %>
      <%= render 'layouts/footer' %>
      <%= debug(params) if Rails.env.development?
    </div>
    </header>
  </body>
</html>
```

###Create header file (\_header.html.erb)
**app/views/layouts/_header.html.erb**

```html
<header class="navbar navbar-fixed-top navbar-inverse">
  <div class="container">
    <%= link_to 'Mobtown', root_path, id: 'logo' %>
    <nav>
      <ul class="nav navbar-nav navbar-right">
        <li><%= link_to 'Home', root_path %></li>
        <li><%= link_to 'Help', help_path %></li>
        <% if logged_in? %>
          <li><%= link_to 'Users', users_path %></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              Account <b class="caret"></b>
            </a>
            <ul>
              <li><%= link_to 'Profile', current_user %></li>
              <li><%= link_to 'Settings', edit_user_path(current_user %>)</li>
              <li class="divider"></li>
              <li> <%= link_to 'Log Out', logout_path, method: 'delete' %></li>
            </ul>
          </li>
        <% else %>
          <li><%= link_to 'Log In', login_path %></li>
        <% end %>
      </ul>
    </nav>
  </div>
</header>
```

###Create footer file (\_footer.html.erb)
**app/views/layouts/_footer.html.erb**

```html
<footer class="footer">
  <div class="mobtown">
    <%= link_to 'Mobtown', root_path %>    
  </div>
  <nav>
    <ul>
      <li><%= link_to 'About', about_path %></li>
      <li><%= link_to 'Contact', contact_path %></li>
    </ul>
  </nav>
</footer>
```

###Create shim file (\_shim.html.erb)
**app/views/layouts/_shim.html.erb**

```html
<!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js">
  </script>
<![endif]-->
```

##Bootstrap and Custom CSS

###Create a file named custom.scss
**app/assets/stylesheets/custom.scss**
```css
@import "bootstrap-sprockets";
@import "bootstrap";

/* mixins, variables, etc. */

$gray-medium-light: #eaeaea;

@mixin box_sizing {
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}

/* Miscellaneous */

.debug_dump {
  clear: both;
  float: left;
  width: 100%;
  margin-top: 45px;
  @include box-sizing;
}

/* Universal */

body {
  padding-top: 60px;
}

section {
  overflow: auto;
}

textarea {
  resize: vertical;
}

.center {
  text-align: center;
  h1 {
    margin-bottom: 10px;
  }
}
/* typography */

h1, h2, h3, h4, h5, h6 {
  line-height: 1;
}

h1 {
  font-size: 3em;
  letter-spacing: -2px;
  margin-bottom: 30px;
  text-align: center;
}

h2 {
  font-size: 1.2em;
  letter-spacing: -1px;
  margin-bottom: 30px;
  font-weight: normal;
  color: $gray-light;
}

p {
  font-size: 1.1em;
  line-height: 1.7em;
}

/* header */

#logo {
  float: left;
  margin-right: 10px;
  font-size: 1.7em;
  color: white;
  text-transform: uppercase;
  letter-spacing: -1px;
  padding-top: 9px;
  font-weight: bold;
  &:hover {
  color: red;
  text-decoration: none;
  }
}

/* footer */

footer {
  margin-top: 45px;
  padding-top: 5px;
  border-top: 1px solid $gray-medium-light;
  color: $gray-light;
  a {
  color: $gray;
  &:hover {
    color: $gray-darker;
    }
  }
  .mobtown {
  float:left;
  }
  ul{
    float: right;
    list-style: none;
    li {
      float: left;
      margin-left: 15px;
    }
  }
}

/* Sidebar */

aside {
  section.user_info {
    margin-top: 20px;
  }
  section {
    padding: 10px 0px;
    margin-top: 20px;
    &:first-child {
      border: 0;
      padding-top: 0;
    }
    span {
      display:block;;
      margin-bottom: 3px;
      line-height: 1;
    }
    h1 {
      font-size: 1.4em;
      text-align: left;
      letter-spacing: -1px;
      margin-bottom: 3px;
      margin-top: 0px;
    }
  }
}


.stats {
  overflow: auto;
  margin-top: 0;
  padding: 0;
  a{
    float: left;
    padding: 0 10px;
    border-left: 1px solid $gray-lighter;
    color: gray;
    &:first-child {
      padding-left: 0;
      border: 0;
    }
    &:hover {
      text-decoration: none;
      color: blue;
    }
  }
  strong {
    display: block;
  }
}

.users.follow {
  padding: 0;
}

/* Forms */

input, textarea, select, .uneditable-input {
  border: 1px solid #bbb;
  width: 100%;
  margin-bottom: 15px;
  @include box-sizing;
}

input {
  height: auto !important;
}

#error_explanation {
  color: red;
  ul {
    color: red;
    margin: 0 0 30px 0;
  }
}

.field_with_errors {
  @extend .has-error;
  .form-control {
    color: $state-danger-text;
  }
}

.checkbox {
  margin-top: -10px;
  margin-bottom: 10px;
  span {
    margin-left: 20px;
    font-weight: normal;
  }
}

#session_remember_me {
  width: auto;
  margin-left: 0;
}

/* User Index */

.users {
  list-style: none;
  margin: 0;
  li {
    overflow: auto;
    padding: 10px 0;
    border-bottom: 1px solid $gray-lighter;
  }
}

/* microposts */

.microposts {
  list-style: none;
  padding: 0;
  li {
    padding: 10px 0;
    border-top: 1px solid #e8e8e8;
  }
  .user {
    margin-top: 5em;
    padding-top: 0;
  }
  .content {
    display: block;
    margin-left: 60px;
    padding: 5px 0;
    img {
      display: block;
      padding: 5px 0;
    }
  }
  .timestamp {
    color: $gray-light;
    display: block;
    margin-left: 60px;

}

aside {
  textarea {
    height: 100px;
    margin-bottom: 5px;
  }
}

span.picture {
  margin-top: 10px;
  input {
    border: 0;
  }
}
```

##Layout Links Test
```ruby
$ rails generate integration_test site_layout
  invoke test_unit
  create   test/integration/site_layout_test.rb
```

**test/integration/site_layout_test.rb**
```ruby
require 'test_helper'

class SiteLayoutTest < ActionDispatch::IntegrationTest

  test 'layout links' do
    get root_path
    assert_template 'static_pages/home'
    assert_select "a[href=?]", root_path, count: 2
    assert_select "a[href=?]", help_path
    assert_select "a[href=?]", about_path
    assert_select "a[href=?]", contact_path
  end
end
```

```ruby
$ rails test:integration
$ rails test
```

***
##User signup
```ruby
$ rails generate controller Users new
    create app/controllers/users_controller.rb
     route get 'users/new'
    invoke erb
    create   app/views/users
    create   app/views/users/new.html.erb
    invoke test_unit
    create   test/controllers/users_controller_test.rb
    invoke helper
    create   app/helpers/users_helper.rb
    invoke   test_unit
    invoke assets
    invoke   coffee
    create     app/assests/javascript/users.coffee
    invoke   scss
    create     app/assets/stylesheets/users.scss
```

**app/controllers/users_controller.rb**
```ruby
class UsersController < ApplicationController
  before_action :logged_in_user, only: [:index, :edit, :update, :destroy,
                                        :follow, :followers]
  before_action :correct_user,   only: [:edit, :update]
  before_action :admin_user,     only: :destroy

  def index
    @users = User.paginate(page: params[:page])
  end

  def show
    @user = User.find(params[:id])
    @microposts = @user.microposts.paginate(page: params[:page])
  end

  def new
    @user = User.new
  end

  def create
    @user = User.new(user_params)
    if @user.save
      @user.send_activation_email
      flash[:info] = 'Please Check you Email to Activate your Account!'
      redirect_to root_url
    else
      render 'new'
    end
  end

  def edit
    @user = User.find(params[:id])
  end

  def update
    @user = User.find(params[:id])
    if @user.update_attributes(user_params)
      flash[:success] = 'Profile Updated!'
      redirect_to @user
    else
      render 'edit'
    end
  end

  def following
    @title = 'Following'
    @user = User.find(params[:id])
    @users = @users.following.paginate(page: params[:page])
    render 'show_follow'
  end

  def followers
    @title = 'Followers'
    @user = User.find(params[:id])
    @users = @users.followers.paginate(page: params[:page])
    render 'show_follow'
  end

  private

  def user_params
    params.require(:user).permit( :name, :email, :password,
                                  :password_confirmation)
  end

  # Before Filters
  def logged_in_user
    unless logged_in?
      store_location
      flash[:danger] = 'Please log in!'
      redirect_to login_url
    end
  end

  def correct_user
    @user = User.find(params[:id])
    redirect_to(root_url) unless current_user?(@user)
  end

  def admin_user
    redirect_to(root_url) unless current_user.admin?
  end
end
```

**test/controllers/users_controller_test.rb**
```ruby
require 'test_helper'

class UserControllerTest < ActionController::TestCase

  def setup
    @user = users(:tim)
    @other_user = users(:archer)
  end

  test 'should redirect index when not logged in' do
    get :index
    assert_redirect_to login_url
  end

  test 'should get new' do
    get :new
    assert_response :success
  end

  test 'should redirect edit when not logged in' do
    get :edit, id: @user
    assert_not flash.empty?
    assert_redirect_to login_url
  end

  test 'should redirect update when not logged in' do
    patch :update, id: @user, user: { name: @user.name, email: @user.email }
    assert_not flash.empty?
    assert_redirect_to login_url
  end

  test 'should redirect edit when logged in as wrong user' do
    log_in_as(@other_user)
    get :edit, id: @user
    assert flash.empty?
    assert_redirect_to root_url
  end

  test 'should redirect update when logged in as wrong user' do
    log_in_as(@other_user)
    patch :update, id: @user, user: { name: @user.name, email: @user.email }
    assert flash.empty?
    assert_redirect_to root_url
  end

  test 'should redirect destroy when not logged in' do
    assert_no_difference 'User.count' do
      delete :destroy, id: @user
    end
    assert_redirect_to root_url
  end

  test 'should redirect destroy when logged in as non-admin' do
    log_in_as(@other_user)
    assert_no_difference 'User.count' do
      delete :destroy, id: @user
    end
    assert_redirect_to root_url
  end

  test 'should redirect following when not logged in' do
    get :following, id: @user
    assert_redirect_to login_url
  end

  test 'should redirect followers when not logged in' do
    get :followers, id: @user
    assert_redirect_to login_url
  end
end
```

##Update routes
**config/routes.rb**
```ruby
Rails.application.routse.draw do
  root 'static_pages#home'
  get 'help' => 'static_pages#help'
  get 'about' => 'static_pages#about'
  get 'cnoatct' => 'sttaic_paegs#contact'
  get 'signup' => 'users#new'
  get 'login' => 'sessions#new'
  post 'login' => 'sessions#create'
  delete 'logout' => 'sessions#destroy'

  resources :users do
    member do
      get :following, :followers
    end
  end

  resources :account_activations, only: [:edit]
  resources :password_resets, only: [:nwe, :create, :edit, :update]
  resources :microposts, only: [:create, :destroy]
  resources :relationships, only: [:create, :destroy]
end
```
